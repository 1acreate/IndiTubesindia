<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IndiTubes</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #fff8f0; }
    header { background: #d40000; color: white; display: flex; justify-content: space-between; align-items: center; padding: 1rem; }
    .wallet { font-weight: bold; }
    .section { display: none; padding: 1rem; }
    .section.active { display: block; }
    nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #eee; }
    nav button { flex: 1; padding: 1rem; border: none; font-weight: bold; background: #f9f9f9; cursor: pointer; }
    .card { background: white; margin: 1rem 0; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    .reward-tag { background: green; color: white; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 10px; }
    .comment { background: #f0f0f0; margin-top: 5px; padding: 5px; border-radius: 5px; }
    input, select, textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: 1px solid #ccc; }
    button.action { background: #d40000; color: white; border: none; padding: 10px; border-radius: 5px; margin-top: 10px; cursor: pointer; }
    .likes { margin-top: 10px; }
    video { width: 100%; border-radius: 10px; }
    .timer { font-weight: bold; color: green; margin-top: 5px; }
    .top-info { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
    .top-info img { border-radius: 50%; width: 40px; height: 40px; }
    .connector { background: yellow; border: none; padding: 5px 10px; border-radius: 5px; margin-left: auto; }
  </style>
</head>
<body>

<header>
  <div>üé• IndiTubes</div>
  <div class="wallet">Wallet: ‚Çπ<span id="wallet">0</span></div>
</header>

<div id="loginBox" style="padding: 2rem; text-align: center;">
  <h2>Login</h2>
  <input id="user" type="text" placeholder="Username" />
  <input id="pass" type="password" placeholder="Password" />
  <button class="action" onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">
  <section id="upload" class="section active">
    <h3>Upload Video</h3>
    <input id="title" type="text" placeholder="Video Title" />
    <input id="channel" type="text" placeholder="Your Channel Name" />
    <input id="channelImg" type="file" accept="image/*" />
    <input id="videoFile" type="file" accept="video/*" />
    <button class="action" onclick="upload()">Upload</button>
  </section>

  <section id="videos" class="section">
    <h3>Watch & Earn</h3>
    <div id="videoList"></div>
  </section>

  <section id="walletSection" class="section">
    <h3>Withdraw</h3>
    <p>Balance: ‚Çπ<span id="balance">0</span></p>
    <input id="name" placeholder="Your Name" />
    <select id="method">
      <option value="">Select Method</option>
      <option>Paytm</option>
      <option>Google Pay</option>
      <option>PhonePe</option>
      <option>UPI</option>
    </select>
    <input id="upi" placeholder="UPI ID or Number" />
    <button class="action" onclick="redeem()">Withdraw</button>
  </section>

  <nav>
    <button onclick="go('upload')">‚¨Ü Upload</button>
    <button onclick="go('videos')">üì∫ Videos</button>
    <button onclick="go('walletSection')">üí∞ Wallet</button>
  </nav>
</div>

<script>
  let wallet = parseInt(localStorage.getItem('wallet') || 0);
  let videos = JSON.parse(localStorage.getItem('videos') || '[]');

  function login() {
    if (user.value && pass.value) {
      loginBox.style.display = 'none';
      app.style.display = 'block';
      document.getElementById('wallet').innerText = wallet;
      document.getElementById('balance').innerText = wallet;
      render();
    }
  }

  function go(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('wallet').innerText = wallet;
    document.getElementById('balance').innerText = wallet;
  }

  function upload() {
    if (!title.value || !channel.value || !channelImg.files[0] || !videoFile.files[0]) return alert('All fields required');
    const vReader = new FileReader();
    const iReader = new FileReader();
    vReader.onload = e => {
      iReader.onload = i => {
        videos.push({title: title.value, channel: channel.value, url: e.target.result, img: i.target.result, earned: false, likes: 0, dislikes: 0, comments: [], connectors: 0});
        localStorage.setItem('videos', JSON.stringify(videos));
        render(); go('videos');
      };
      iReader.readAsDataURL(channelImg.files[0]);
    };
    vReader.readAsDataURL(videoFile.files[0]);
  }

  function render() {
    videoList.innerHTML = '';
    videos.forEach((v, i) => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <video id="vid${i}" src="${v.url}" controls></video>
        <div class="timer" id="timer${i}">‚è± Not started</div>
        <div class="reward-tag">Earn ‚Çπ5</div>
        <h4>${v.title}</h4>
        <div class="top-info">
          <img src="${v.img}" />
          <strong>${v.channel}</strong>
          <button class="connector" onclick="connect(${i}, this)">Connector (${v.connectors})</button>
        </div>
        <div class="likes">
          <button onclick="like(${i})">üëç (${v.likes})</button>
          <button onclick="dislike(${i})">üëé (${v.dislikes})</button>
          <button onclick="share()">üîó Share</button>
        </div>
        <textarea id="comment${i}" placeholder="Leave a comment..."></textarea>
        <button onclick="addComment(${i})">Comment</button>
        <div id="comments${i}">${v.comments.map(c=>`<div class='comment'>${c}</div>`).join('')}</div>
      `;
      videoList.appendChild(div);
      setupTimer(i);
    });
  }

  function setupTimer(i) {
    const vid = document.getElementById(`vid${i}`);
    const timer = document.getElementById(`timer${i}`);
    let earned = videos[i].earned;
    let intv;
    vid.addEventListener('play', () => {
      if (earned) { timer.innerText = '‚úÖ Already Earned'; return; }
      clearInterval(intv);
      intv = setInterval(() => {
        const t = Math.floor(vid.currentTime);
        if (t >= 30) {
          clearInterval(intv);
          wallet += 5;
          videos[i].earned = true;
          update();
          timer.innerText = '‚úÖ Earned ‚Çπ5!';
        } else {
          timer.innerText = `‚è± Watching: ${t}/30 sec`;
        }
      }, 1000);
    });
  }

  function update() {
    localStorage.setItem('videos', JSON.stringify(videos));
    localStorage.setItem('wallet', wallet);
    document.getElementById('wallet').innerText = wallet;
    document.getElementById('balance').innerText = wallet;
    render();
  }

  function like(i) { videos[i].likes++; update(); }
  function dislike(i) { videos[i].dislikes++; update(); }
  function connect(i, btn) { videos[i].connectors++; btn.disabled = true; update(); }
  function addComment(i) {
    const c = document.getElementById(`comment${i}`).value;
    if (!c) return;
    videos[i].comments.push(c);
    update();
  }
  function share() {
    if (navigator.share) navigator.share({ title: 'Watch this on IndiTubes', url: location.href });
    else alert('Sharing not supported');
  }

  function redeem() {
    if (wallet < 100) return alert('Minimum ‚Çπ100 needed');
    if (!name.value || !method.value || !upi.value) return alert('Fill all fields');
    alert(`Withdraw request sent for ‚Çπ${wallet} via ${method.value} to ${upi.value}`);
    wallet = 0; update();
  }
</script>
</body>
</html>
